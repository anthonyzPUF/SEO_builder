<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SEO_builder Pro</title>
  <style>
    /* --- Same styles as before --- */
    body{margin:0;font-family:ui-sans-serif;background:#0b0f14;color:#e6edf3}
    header{padding:20px;background:#0f1520;border-bottom:1px solid #1f2835}
    h1{margin:0;font-size:22px;font-weight:800;color:#F15A22}
    main{padding:20px;display:grid;grid-template-columns:330px 1fr;gap:16px}
    .card{background:#121822;border:1px solid #1f2835;border-radius:14px;padding:14px}
    .btn{background:#1a2436;border:1px solid #1f2835;border-radius:10px;padding:10px;color:#e6edf3;cursor:pointer}
    .btn.primary{background:#F15A22;border-color:#a63a13}
    .btn.primary:hover{background:#d94e1e}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:8px;border-bottom:1px solid #1f2835;font-size:13px}
    th{color:#F15A22;text-align:left}
    .pill{padding:2px 6px;border-radius:6px;font-size:11px}
    .pill.high{background:#2ef39722;color:#48d597}
    .pill.med{background:#ffd16622;color:#ffd166}
    .pill.low{background:#ff9fb022;color:#ff7b92}
    .sidebar{position:fixed;top:0;right:-40vw;width:40vw;height:100vh;background:#0f1520;border-left:1px solid #1f2835;transition:right .3s}
    .sidebar.open{right:0}
  </style>
</head>
<body>
  <header>
    <h1>PragerU SEO Builder Pro</h1>
    <div>Multi-feed keyword engine + Ad Copy Generator</div>
  </header>
  <main>
    <section class="card">
      <h2>Inputs</h2>
      <label>Title</label><input id="title" type="text" placeholder="Cash Course: Student Loans 101"/>
      <label>Description</label><textarea id="description"></textarea>
      <label>Show</label><input id="show" type="text" placeholder="Cash Course"/>
      <label>Brand</label><input id="brand" type="text" value="PragerU Kids"/>
      <label>Topic Override</label><input id="topic_override" type="text"/>
      <div style="margin-top:10px">
        <button class="btn primary" id="generate">Generate</button>
        <button class="btn" id="openCopy" disabled>Generate Ad Copy</button>
        <button class="btn" id="reset">Reset</button>
      </div>
    </section>
    <section class="card">
      <h2>Keyword Output</h2>
      <div id="outputArea">No results yet.</div>
    </section>
  </main>

  <!-- Ad Copy Sidebar -->
  <div class="sidebar" id="adSidebar">
    <h2 style="padding:12px;color:#F15A22">Ad Copy</h2>
    <div id="pane-heads" style="padding:10px"></div>
    <div id="pane-descs" style="padding:10px"></div>
    <button class="btn" id="closeSidebar" style="margin:10px">Close</button>
  </div>

  <script>
    /* ---------- Utilities ---------- */
    const STOPWORDS=new Set("a an and are as at be by for from has have how i in into is it its just more new of on or our out the their them they this to up what when where which who why with your".split(" "));
    function norm(s){return(s||"").normalize("NFKC").replace(/[–—]/g,"-").trim()}
    function toks(s){s=norm(s.toLowerCase());const m=s.match(/[a-z0-9']+/g)||[];return m.filter(t=>!STOPWORDS.has(t))}
    function unique(a){return[...new Set(a)]}
    async function safeFetch(url,opts={},timeout=8000){
      const controller=new AbortController();const id=setTimeout(()=>controller.abort(),timeout);
      try{const r=await fetch(url,{...opts,signal:controller.signal});return r.ok?await r.json():null;}
      catch(e){return null}finally{clearTimeout(id)}
    }

    /* ---------- Keyword Engine ---------- */
    class KeywordEngine {
      constructor(){this.rows=[]}
      reset(){this.rows=[]}

      extractTopics(inp){
        const tt=toks(inp.title),dt=toks(inp.description),st=toks(inp.show);
        const all=[...tt,...dt];const counts={};all.forEach(w=>counts[w]=(counts[w]||0)+1);
        const common=Object.entries(counts).sort((a,b)=>b[1]-a[1]).slice(0,20).map(x=>x[0]);
        return{core_terms:unique([...tt,...st]),topic_phrases:unique([...common,...st])}
      }

      async fetchFeeds(seed){
        const results={}
        results.datamuse=await this.datamuse(seed)
        results.wiki=await this.wikiEntities(seed)
        results.ddg=await this.duckRelated(seed)
        results.books=await this.openLibrary(seed)
        results.stack=await this.stackEx(seed)
        return results
      }

      async datamuse(q){
        const u=`https://api.datamuse.com/words?ml=${encodeURIComponent(q)}&max=20`
        const j=await safeFetch(u);return j?(j.map(x=>x.word)):[]
      }
      async wikiEntities(seed){
        const u=`https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(seed)}&srlimit=5&format=json&origin=*`
        const j=await safeFetch(u);return j?.query?.search?.map(x=>x.title.toLowerCase())||[]
      }
      async duckRelated(seed){
        const u=`https://api.duckduckgo.com/?q=${encodeURIComponent(seed)}&format=json&no_html=1`
        const j=await safeFetch(u);return j?(j.RelatedTopics||[]).map(x=>x.Text).filter(Boolean):[]
      }
      async openLibrary(seed){
        const u=`https://openlibrary.org/search.json?q=${encodeURIComponent(seed)}`
        const j=await safeFetch(u);return j?(j.docs||[]).slice(0,10).map(d=>d.title.toLowerCase()):[]
      }
      async stackEx(seed){
        const u=`https://api.stackexchange.com/2.3/search/excerpts?order=desc&sort=relevance&q=${encodeURIComponent(seed)}&site=parenting`
        const j=await safeFetch(u);return j?(j.items||[]).map(it=>it.title):[]
      }

      scoreKeyword(kw,inp){
        let score=0
        if(inp.title.toLowerCase().includes(kw))score+=10
        if(inp.description.toLowerCase().includes(kw))score+=5
        if(inp.show.toLowerCase().includes(kw))score+=6
        if(kw.split(" ").length<=4)score+=4
        if(kw.length>20)score-=2
        return Math.max(0,score)
      }

      async generate(inp){
        const parts=this.extractTopics(inp)
        const seed=inp.topic_override||parts.topic_phrases[0]||inp.title
        const feeds=await this.fetchFeeds(seed)
        const all=unique([...parts.core_terms,...parts.topic_phrases,...feeds.datamuse,...feeds.wiki,...feeds.ddg,...feeds.books,...feeds.stack])
        this.rows=all.map(k=>({keyword:k,score:this.scoreKeyword(k,inp)}))
        return this.rows.sort((a,b)=>b.score-a.score)
      }
    }

    /* ---------- Ad Copy Engine ---------- */
    class AdCopyEngine {
      buildHeadlines(topic,brand){
        return unique([
          `${topic} 101`,`Learn ${topic} Today`,`${topic} Explained`,
          `${brand} ${topic}`,`Free ${topic} Lessons`
        ]).slice(0,10)
      }
      buildDescriptions(topic,brand){
        return [
          `Learn ${topic} with ${brand}. Trusted free videos.`,
          `${brand} makes ${topic} simple and clear.`,
          `Watch ${topic} lessons anytime.`
        ]
      }
    }

    /* ---------- UI Controller ---------- */
    class UIController {
      constructor(){
        this.keywordEngine=new KeywordEngine()
        this.adEngine=new AdCopyEngine()
        this.bindUI()
      }
      bindUI(){
        document.getElementById("generate").onclick=()=>this.generate()
        document.getElementById("reset").onclick=()=>this.reset()
        document.getElementById("openCopy").onclick=()=>this.openCopy()
        document.getElementById("closeSidebar").onclick=()=>document.getElementById("adSidebar").classList.remove("open")
      }
      async generate(){
        const inp={title:val("title"),description:val("description"),show:val("show"),brand:val("brand"),topic_override:val("topic_override")}
        const rows=await this.keywordEngine.generate(inp)
        const table=`<table><tr><th>Keyword</th><th>Score</th><th>Priority</th></tr>`+
          rows.slice(0,40).map(r=>{
            const p=r.score>15?"High":r.score>8?"Medium":"Low"
            return `<tr><td>${r.keyword}</td><td>${r.score}</td><td><span class="pill ${p.toLowerCase()}">${p}</span></td></tr>`
          }).join("")+`</table>`
        document.getElementById("outputArea").innerHTML=table
        document.getElementById("openCopy").disabled=false
      }
      reset(){
        this.keywordEngine.reset()
        ["title","description","show","brand","topic_override"].forEach(id=>setval(id,""))
        document.getElementById("outputArea").innerHTML="Reset."
        document.getElementById("openCopy").disabled=true
      }
      openCopy(){
        const topic=val("topic_override")||val("title")||"Topic"
        const brand=val("brand")||"PragerU"
        const H=this.adEngine.buildHeadlines(topic,brand)
        const D=this.adEngine.buildDescriptions(topic,brand)
        document.getElementById("pane-heads").innerHTML=H.map(h=>`<div>${h}</div>`).join("")
        document.getElementById("pane-descs").innerHTML=D.map(d=>`<div>${d}</div>`).join("")
        document.getElementById("adSidebar").classList.add("open")
      }
    }

    /* ---------- Helpers ---------- */
    function val(id){return document.getElementById(id).value}
    function setval(id,v){document.getElementById(id).value=v}

    /* ---------- Init ---------- */
    new UIController()
  </script>
</body>
</html>
